# name: CI - Build and Test (Develop)
# 
# on:
#   push:
#     branches: [ develop ]
#     paths:
#       - 'back/**'  # O CI só roda se houver mudanças na pasta do backend
#   pull_request:
#     branches: [ develop ]
#     paths:
#       - 'back/**'  # Evita que mudanças apenas na infra quebrem o build do backend
# 
# jobs:
#   build:
#     runs-on: ubuntu-latest
# 
#     # Mantemos o diretório padrão para todos os 'run' deste job
#     defaults:
#       run:
#         working-directory: back/cadastros-usuario  
# 
#     services:
#       postgres:
#         image: postgres:14
#         env:
#           POSTGRES_DB: cadastro_user_db
#           POSTGRES_USER: ana
#           POSTGRES_PASSWORD: 230406
#         ports:
#           - 5432:5432
#         options: >-
#           --health-cmd pg_isready
#           --health-interval 10s
#           --health-timeout 5s
#           --health-retries 5
# 
#     steps:
#       - name: Checkout do código
#         uses: actions/checkout@v4
# 
#       - name: Setup JDK 17
#         uses: actions/setup-java@v4
#         with:
#           distribution: 'corretto'
#           java-version: '17'
# 
#       - name: Permitir execução do Maven wrapper
#         # O working-directory garante que o shell já esteja na pasta correta
#         run: chmod +x mvnw
# 
#       - name: Rodar build e testes
#         # Injetamos as propriedades do banco via linha de comando para garantir sucesso no teste
#         run: |
#           ./mvnw clean test \
#             -Dspring.datasource.url=jdbc:postgresql://localhost:5432/cadastro_user_db \
#             -Dspring.datasource.username=ana \
#             -Dspring.datasource.password=230406